# Конфигурация для экспортированных системных журналов Windows
C:\Logs\System\*.evtx {
    monthly
    rotate 24          # Хранить 2 года
    compress
    missingok
    notifempty
    
    # Создание файла с определенными правами
    create
    
    # Команды, выполняемые до ротации
    prerotate
        # Экспорт текущих системных журналов перед ротацией
        $date = Get-Date -Format "yyyy-MM-dd"
        $logName = "System"
        $exportPath = "C:\Logs\System\SystemLog-$date.evtx"
        
        # Выгрузка журнала в файл
        # wevtutil epl System $exportPath
        
        Write-Host "Журнал системы экспортирован в $exportPath"
    endscript
    
    # Команды после ротации
    postrotate
        # Очистка системных журналов после экспорта и ротации
        # wevtutil cl System
        
        Write-Host "Системный журнал очищен"
    endscript
}

# Конфигурация для журналов безопасности
C:\Logs\Security\*.evtx {
    weekly
    rotate 52          # Хранить год
    compress
    missingok
    notifempty
    
    # Особые правила для журналов безопасности
    # Например, шифрование архивов
    compresscmd "PowerShell -Command { Compress-Archive -Path '%1' -DestinationPath '%2'; Protect-CmsMessage -Path '%2' -To 'cn=LogAdmin' }"
    
    # Выполнение перед ротацией
    prerotate
        $date = Get-Date -Format "yyyy-MM-dd"
        $logName = "Security"
        $exportPath = "C:\Logs\Security\SecurityLog-$date.evtx"
        
        # wevtutil epl Security $exportPath
        
        Write-Host "Журнал безопасности экспортирован в $exportPath"
    endscript
}

# Конфигурация для журналов приложений
C:\Logs\Application\*.evtx {
    daily
    rotate 30          # Хранить месяц
    compress
    missingok
    notifempty
    
    # Особые правила для журналов приложений
    maxage 31          # Максимальный срок хранения в днях
    
    # Выполнение перед ротацией
    prerotate
        $date = Get-Date -Format "yyyy-MM-dd"
        $logName = "Application"
        $exportPath = "C:\Logs\Application\ApplicationLog-$date.evtx"
        
        # wevtutil epl Application $exportPath
        
        Write-Host "Журнал приложений экспортирован в $exportPath"
    endscript
} 