# Конфигурация Logrotate для очистки и ротации файлов логов в C:\Windows\Logs
# Обработка всех файлов логов в папке C:\Windows\Logs и её поддиректориях
# Удаление файлов старше 1 дня
# ВНИМАНИЕ: Для обработки этих файлов требуются права администратора!

# Основная секция для логов Windows
"C:\Windows\Logs\*" {
    # Проверять все файлы в поддиректориях
    recurse
    
    # Удалять файлы старше 1 дня
    maxage 1
    
    # Ротация ежедневно
    daily
    
    # Не нужно хранить старые копии
    rotate 0
    
    # Не сжимать
    nocompress
    
    # Удалить файл после ротации, но не создавать новый
    nocreate
    
    # Требуется для выполнения команд из скриптов
    ifempty
    
    # Игнорировать ошибки отсутствия файлов
    missingok
    
    # Скрипт для выполнения перед ротацией
    prerotate
        Write-LogRotateMessage "Начинаем обработку логов в C:\Windows\Logs" "INFO"
    endscript
    
    # Скрипт для выполнения после ротации
    postrotate
        Write-LogRotateMessage "Завершена обработка логов в C:\Windows\Logs" "INFO"
        # Удаление пустых директорий
        Get-ChildItem -Path "C:\Windows\Logs" -Recurse -Directory | 
        Where-Object { (Get-ChildItem -Path $_.FullName -File -Recurse).Count -eq 0 } | 
        ForEach-Object { 
            Write-LogRotateMessage "Очистка пустой директории: $($_.FullName)" "INFO"
            # Аккуратно с удалением пустых директорий в Windows!
            # Иногда директории могут быть пустыми, но всё еще использоваться системой
            # Поэтому мы только логируем, но не удаляем
        }
    endscript
} 