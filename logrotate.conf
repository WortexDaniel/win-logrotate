# Глобальные настройки по умолчанию
weekly               # Ротация каждую неделю
rotate 4             # Хранить 4 копии старых файлов
compress             # Сжимать файлы после ротации
compressext .zip     # Использовать расширение .zip для сжатых файлов
create               # Создавать новый пустой файл после ротации

# Включение дополнительных конфигураций
include conf.d/*.conf

# Ротация для IIS логов
C:\inetpub\logs\LogFiles\W3SVC*\*.log {
    daily             # Ежедневная ротация
    rotate 7          # Хранить 7 копий (неделю)
    copytruncate      # Копировать и очищать оригинальный файл
    missingok         # Не выдавать ошибку, если файла нет
    notifempty        # Не обрабатывать пустые файлы
    
    # Команды, выполняемые перед ротацией
    prerotate
        # Можно использовать PowerShell код
        Write-Host "Начинаем ротацию логов IIS"
    endscript
    
    # Команды, выполняемые после ротации
    postrotate
        # Например, перезапуск службы или отправка уведомления
        # Restart-Service -Name W3SVC -Force
        Write-Host "Ротация логов IIS завершена"
    endscript
}

# Ротация для собственных лог-файлов приложения
C:\logs\app\*.log {
    size 10M          # Ротация по размеру (если больше 10 МБ)
    monthly           # Ротация ежемесячно
    rotate 12         # Хранить годовой архив
    compress          # Сжимать
    dateext           # Добавлять дату к имени ротированного файла
    dateformat -%Y%m%d-%s  # Формат даты
    
    # Перезапуск службы после ротации
    postrotate
        # Restart-Service -Name MyAppService -Force
    endscript
}

# Ротация для Windows Event логов (экспортируемых)
C:\Logs\EventLogs\*.evtx {
    yearly            # Ротация раз в год
    rotate 5          # Хранить 5 лет
    compress          # Сжимать
    compresscmd "PowerShell -Command Compress-Archive"  # Использовать PowerShell команду
    notifempty        # Не обрабатывать пустые файлы
}

# Пример ротации журналов SQL Server
C:\Program Files\Microsoft SQL Server\*\MSSQL\Log\ERRORLOG* {
    daily
    rotate 14         # Хранить 2 недели
    missingok
    compress
    
    # Можно выполнить резервное копирование перед ротацией
    prerotate
        # Код для бэкапа базы данных
    endscript
} 